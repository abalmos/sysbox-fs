package main

import (
	"strconv"
	"time"
)

//
// File in charge of hosting all the logic dealing with the container-state
// required by Sysvisorfs for its operation.
//

//
// Container type to represent all the container-state relevant to sysvisorfs.
//
type containerState struct {
	id         string    // container-id value generated by runC
	initPid    uint32    // initPid within container
	hostname   string    // defined container hostname
	ctime      time.Time // container creation time
	uidFirst   uint32    // first value of Uid range (host side)
	uidSize    uint32    // Uid range size
	gidFirst   uint32    // first value of Gid range (host side)
	gidSize    uint32    // Gid range size
	pidNsInode uint64    // inode associated to container's pid-ns
}

// ContainerState constructor.
func newContainerState(
	id string,
	initPid uint32,
	hostname string,
	uidFirst uint32,
	uidSize uint32,
	gidFirst uint32,
	gidSize uint32) (*containerState, error) {

	cntr := &containerState{
		id:         id,
		initPid:    initPid,
		hostname:   hostname,
		ctime:      time.Time{}, // initializing ctime with zeroed-timestamp
		uidFirst:   uidFirst,
		uidSize:    uidSize,
		gidFirst:   gidFirst,
		gidSize:    gidSize,
		pidNsInode: 0,
	}

	return cntr, nil
}

// String() specialization for Container type.
func (c *containerState) String() string {

	return "\n\t\t id: " + c.id + "\n" +
		"\t\t initPid: " + strconv.Itoa(int(c.initPid)) + "\n" +
		"\t\t hostname: " + c.hostname + "\n" +
		"\t\t ctime: " + c.ctime.String() + "\n" +
		"\t\t pidNsInode: " + strconv.FormatUint(c.pidNsInode, 10)
}
